<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Analytics</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: 'SF Pro Display', -apple-system, system-ui, BlinkMacSystemFont;
            margin: 0;
            padding: 0;
            background-color: #000;
            color: #fff;
        }

        .container {
            max-width: 100%;
            padding: 16px;
        }

        /* –°–æ–≥–ª–∞—à–µ–Ω–∏–µ */
        .agreement {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #000;
            padding: 20px;
            z-index: 100;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .agreement-text {
            font-size: 16px;
            line-height: 1.5;
            margin-bottom: 30px;
            color: #fff;
        }

        /* –ú–µ–Ω—é */
        .menu-item {
            border: 1px solid #333;
            margin: 8px 0;
            padding: 16px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: border-color 0.2s;
        }

        .menu-item:active {
            border-color: #fff;
        }

        .menu-icon {
            margin-right: 12px;
            font-size: 20px;
        }

        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .stats-card {
            border: 1px solid #333;
            border-radius: 12px;
            padding: 16px;
            margin: 8px 0;
        }

        .stats-number {
            font-size: 32px;
            font-weight: bold;
            margin: 8px 0;
        }

        .stats-label {
            color: #888;
            font-size: 14px;
        }

        /* –ê–Ω–∞–ª–∏–∑ */
        .analysis-input {
            background: none;
            border: 1px solid #333;
            color: #fff;
            padding: 16px;
            border-radius: 12px;
            width: 100%;
            margin: 8px 0;
            font-size: 16px;
            box-sizing: border-box;
        }

        /* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ */
        .settings-section {
            border: 1px solid #333;
            border-radius: 12px;
            padding: 16px;
            margin: 16px 0;
        }

        .settings-title {
            font-size: 18px;
            margin-bottom: 12px;
            color: #888;
        }

        .button {
            background: none;
            border: 1px solid #333;
            color: #fff;
            padding: 16px;
            border-radius: 12px;
            width: 100%;
            font-size: 16px;
            margin: 8px 0;
            cursor: pointer;
            transition: border-color 0.2s;
        }

        .button:active {
            border-color: #fff;
        }

        /* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ */
        .switch {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #333;
        }

        .switch-label {
            color: #fff;
        }

        /* –í–∫–ª–∞–¥–∫–∏ */
        .section {
            display: none;
            animation: fadeIn 0.3s;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ */
        .progress-bar {
            width: 100%;
            height: 4px;
            background: #333;
            border-radius: 2px;
            margin: 8px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #fff;
            width: 0%;
            transition: width 0.3s;
        }

        .tag {
            display: inline-block;
            padding: 4px 8px;
            border: 1px solid #333;
            border-radius: 12px;
            margin: 4px;
            font-size: 12px;
        }

        select.analysis-input {
            appearance: none;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='white'%3E%3Cpath d='M6 9L0 0h12'/%3E%3C/svg%3E") no-repeat right 16px center;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏ */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .loading-content {
            text-align: center;
            padding: 20px;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid #333;
            border-top: 3px solid #fff;
            border-radius: 50%;
            margin: 0 auto 20px;
            animation: spin 1s linear infinite;
        }

        .loading-text {
            color: #fff;
            font-size: 18px;
            margin-bottom: 20px;
        }

        .progress-bar {
            background: #333;
            height: 4px;
            border-radius: 2px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-fill {
            background: #fff;
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text, .progress-stats {
            color: #888;
            font-size: 14px;
            margin: 5px 0;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ */
        .analysis-results {
            animation: fadeIn 0.5s ease;
        }

        .stats-card {
            background: linear-gradient(45deg, #1a1a1a, #2a2a2a);
            border: 1px solid #333;
            padding: 20px;
            margin: 10px 0;
            border-radius: 12px;
            transition: transform 0.3s ease;
        }

        .stats-card:hover {
            transform: translateY(-2px);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <!-- –°–æ–≥–ª–∞—à–µ–Ω–∏–µ -->
    <div id="agreement" class="agreement">
        <div class="agreement-text">
            –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ:
            
            1. –ë–æ—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –æ—Ç–∫—Ä—ã—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ –≥—Ä—É–ø–ø
            2. –í—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö
            3. –ö–æ–º–∏—Å—Å–∏—è –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ –±–æ—Ç–∞
            
            –ü—Ä–æ–¥–æ–ª–∂–∞—è, –≤—ã –ø—Ä–∏–Ω–∏–º–∞–µ—Ç–µ —É—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.
        </div>
        <button class="button" onclick="acceptAgreement()">–ü—Ä–∏–Ω—è—Ç—å –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="container" id="main-content" style="display: none;">
        <!-- –ú–µ–Ω—é -->
        <div id="menu" class="section active">
            <div class="menu-item" onclick="showSection('stats')">
                <div class="menu-icon">üìä</div>
                <div>–ú–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
            </div>
            <div class="menu-item" onclick="showSection('analysis')">
                <div class="menu-icon">üîç</div>
                <div>–ê–Ω–∞–ª–∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–∞</div>
            </div>
            <div class="menu-item" onclick="showSection('settings')">
                <div class="menu-icon">‚öôÔ∏è</div>
                <div>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
            </div>
            <div class="menu-item" onclick="showSection('faq')">
                <div class="menu-icon">‚ùì</div>
                <div>–í–æ–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã</div>
            </div>
        </div>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div id="stats" class="section">
            <div class="stats-card">
                <div class="stats-number">0</div>
                <div class="stats-label">–ü–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –ø–æ–ª—É—á–µ–Ω–æ</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 0%"></div>
                </div>
            </div>
            <div class="stats-card">
                <div class="stats-number">0%</div>
                <div class="stats-label">–ö–æ–Ω–≤–µ—Ä—Å–∏—è –ø–æ–¥–ø–∏—Å–æ–∫</div>
            </div>
            <div class="stats-card">
                <div class="stats-number">0</div>
                <div class="stats-label">–ü–æ–¥–∞—Ä–∫–æ–≤ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ</div>
            </div>
            <div class="stats-card">
                <div class="stats-number">0 TON</div>
                <div class="stats-label">–°—ç–∫–æ–Ω–æ–º–ª–µ–Ω–æ –Ω–∞ –∫–æ–º–∏—Å—Å–∏–∏</div>
            </div>
            <button class="button" onclick="showSection('menu')">–ù–∞–∑–∞–¥</button>
        </div>

        <!-- –ê–Ω–∞–ª–∏–∑ -->
        <div id="analysis" class="section">
            <div class="settings-section">
                <div class="settings-title">–ò—Å—Ç–æ—á–Ω–∏–∫</div>
                <input type="text" class="analysis-input" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –≥—Ä—É–ø–ø—É">
                <div class="switch">
                    <span class="switch-label">–¢–æ–ª—å–∫–æ Premium</span>
                    <input type="checkbox" id="premium-only">
                </div>
                <div class="switch">
                    <span class="switch-label">–ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é</span>
                    <input type="checkbox" id="active-week" checked>
                </div>
                <input type="number" class="analysis-input" placeholder="–ú–∏–Ω–∏–º—É–º –ø–æ–¥–∞—Ä–∫–æ–≤" value="1">
            </div>
            
            <div class="settings-section">
                <div class="settings-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–Ω–∞–ª–∏–∑–∞</div>
                <select class="analysis-input" id="message-limit">
                    <option value="2000">2000 —Å–æ–æ–±—â–µ–Ω–∏–π</option>
                    <option value="4000">4000 —Å–æ–æ–±—â–µ–Ω–∏–π</option>
                    <option value="6000">6000 —Å–æ–æ–±—â–µ–Ω–∏–π</option>
                    <option value="8000">8000 —Å–æ–æ–±—â–µ–Ω–∏–π</option>
                    <option value="10000">10000 —Å–æ–æ–±—â–µ–Ω–∏–π</option>
                </select>
            </div>
            
            <button class="button" onclick="analyzeGroup()">–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å</button>
            
            <div class="loading-overlay" style="display: none;">
                <div class="loading-content">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –≥—Ä—É–ø–ø—É...</div>
                    <div class="loading-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 0%"></div>
                        </div>
                        <div class="progress-text">–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ: <span id="progress-percent">0</span>%</div>
                        <div class="progress-stats">
                            –ù–∞–π–¥–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: <span id="progress-found">0</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="analysis-results" style="display: none;">
                <div class="stats-card">
                    <div class="stats-number" id="total-potential">0</div>
                    <div class="stats-label">–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤</div>
                </div>
                <div class="stats-card">
                    <div class="stats-number" id="premium-percent">0%</div>
                    <div class="stats-label">Premium-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                </div>
                <div class="stats-card">
                    <div class="stats-number" id="avg-gifts">0</div>
                    <div class="stats-label">–°—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–∞—Ä–∫–æ–≤</div>
                </div>
            </div>
            
            <button class="button" onclick="showSection('settings')">–ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É</button>
            <button class="button" onclick="showSection('menu')">–ù–∞–∑–∞–¥</button>
        </div>

        <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
        <div id="settings" class="section">
            <div class="settings-section">
                <div class="settings-title">–í–∞—à–∞ –≥—Ä—É–ø–ø–∞</div>
                <input type="text" class="analysis-input" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ –≤–∞—à—É –≥—Ä—É–ø–ø—É">
                <button class="button" onclick="addBot()">–î–æ–±–∞–≤–∏—Ç—å –±–æ—Ç–∞</button>
            </div>

            <div class="settings-section">
                <div class="settings-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞—Å—Å—ã–ª–∫–∏</div>
                <div class="switch">
                    <span class="switch-label">–û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ–¥–∞—Ä–∫–∏</span>
                    <input type="checkbox" id="gifts-enabled" checked>
                </div>
                <select class="analysis-input" id="gift-type">
                    <option value="1">–ú–∞–ª–µ–Ω—å–∫–∏–π –ø–æ–¥–∞—Ä–æ–∫ (1 –∑–≤–µ–∑–¥–∞)</option>
                    <option value="3">–°—Ä–µ–¥–Ω–∏–π –ø–æ–¥–∞—Ä–æ–∫ (3 –∑–≤–µ–∑–¥—ã)</option>
                    <option value="5">–ë–æ–ª—å—à–æ–π –ø–æ–¥–∞—Ä–æ–∫ (5 –∑–≤–µ–∑–¥)</option>
                </select>
                <div class="switch">
                    <span class="switch-label">–¢–æ–ª—å–∫–æ —Å –ø–æ–¥–∞—Ä–∫–∞–º–∏</span>
                    <input type="checkbox" id="gifts-only" checked>
                </div>
                <div class="switch">
                    <span class="switch-label">Premium –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</span>
                    <input type="checkbox" id="premium-users">
                </div>
                <input type="number" class="analysis-input" placeholder="–õ–∏–º–∏—Ç —Ä–∞—Å—Å—ã–ª–∫–∏ –≤ –¥–µ–Ω—å" value="100">
            </div>

            <div class="settings-section">
                <div class="settings-title">–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è</div>
                <textarea class="analysis-input" rows="4" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è"></textarea>
            </div>

            <div class="settings-section">
                <div class="settings-title">–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è</div>
                <div class="switch">
                    <span class="switch-label">–ê–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–æ–∫</span>
                    <input type="checkbox" id="auto-check" checked>
                </div>
                <select class="analysis-input" id="check-interval">
                    <option value="24">–ö–∞–∂–¥—ã–µ 24 —á–∞—Å–∞</option>
                    <option value="48">–ö–∞–∂–¥—ã–µ 48 —á–∞—Å–æ–≤</option>
                    <option value="72">–ö–∞–∂–¥—ã–µ 72 —á–∞—Å–∞</option>
                </select>
            </div>

            <button class="button" onclick="saveSettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <button class="button" onclick="showSection('menu')">–ù–∞–∑–∞–¥</button>
        </div>

        <!-- FAQ -->
        <div id="faq" class="section">
            <div class="settings-section">
                <div class="settings-title">–ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã</div>
                <div class="stats-card">
                    <strong>–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?</strong>
                    <p>–ë–æ—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –Ω–∞–∏–±–æ–ª–µ–µ –∑–∞–∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–Ω–Ω—ã–º.</p>
                </div>
                <div class="stats-card">
                    <strong>–°–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç?</strong>
                    <p>–ö–æ–º–∏—Å—Å–∏—è –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫. –° –±–æ—Ç–æ–º-–∞–¥–º–∏–Ω–æ–º –ø–ª–∞—Ç–∏—Ç–µ —Ç–æ–ª—å–∫–æ –∑–∞ —É—Å–ø–µ—à–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏.</p>
                </div>
                <div class="stats-card">
                    <strong>–ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –±–æ—Ç–∞?</strong>
                    <p>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –≤—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –≤–∞—à—É –≥—Ä—É–ø–ø—É –∏ –Ω–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å –±–æ—Ç–∞". –ó–∞—Ç–µ–º –¥–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –≥—Ä—É–ø–ø—ã.</p>
                </div>
            </div>
            <button class="button" onclick="showSection('menu')">–ù–∞–∑–∞–¥</button>
        </div>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();

        // –ü—Ä–∏–Ω—è—Ç–∏–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏—è
        function acceptAgreement() {
            document.getElementById('agreement').style.display = 'none';
            document.getElementById('main-content').style.display = 'block';
        }

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
        }

        // –ê–Ω–∞–ª–∏–∑ –≥—Ä—É–ø–ø—ã
        function analyzeGroup() {
            const input = document.querySelector('.analysis-input').value;
            const messageLimit = document.getElementById('message-limit').value;
            
            if (!input) {
                tg.showAlert('–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –≥—Ä—É–ø–ø—É');
                return;
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–≤–µ—Ä–ª–µ–π –∑–∞–≥—Ä—É–∑–∫–∏
            document.querySelector('.loading-overlay').style.display = 'flex';
            document.querySelector('.analysis-results').style.display = 'none';
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
            document.querySelector('.progress-fill').style.width = '0%';
            document.getElementById('progress-percent').textContent = '0';
            document.getElementById('progress-found').textContent = '0';
            
            tg.sendData(JSON.stringify({
                action: 'analyze_group',
                group_link: input,
                message_limit: messageLimit
            }));
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–æ—Ç–∞
        function addBot() {
            const input = document.querySelector('.analysis-input').value;
            if (!input) {
                tg.showAlert('–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –≥—Ä—É–ø–ø—É');
                return;
            }

            tg.sendData(JSON.stringify({
                action: 'add_bot',
                group_link: input
            }));
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
        function saveSettings() {
            const settings = {
                action: 'save_settings',
                gifts_enabled: document.getElementById('gifts-enabled').checked,
                gift_type: document.getElementById('gift-type').value,
                message: document.querySelector('textarea').value,
                targeting: {
                    gifts_only: document.getElementById('gifts-only').checked,
                    premium_users: document.getElementById('premium-users').checked,
                    daily_limit: document.querySelector('input[placeholder="–õ–∏–º–∏—Ç —Ä–∞—Å—Å—ã–ª–∫–∏ –≤ –¥–µ–Ω—å"]').value
                },
                automation: {
                    auto_check: document.getElementById('auto-check').checked,
                    check_interval: document.getElementById('check-interval').value
                }
            };

            tg.sendData(JSON.stringify(settings));
            tg.showAlert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats(data) {
            const numbers = document.querySelectorAll('.stats-number');
            numbers[0].textContent = data.subscribers || '0';
            numbers[1].textContent = data.conversion ? data.conversion + '%' : '0%';
            numbers[2].textContent = data.gifts || '0';
            numbers[3].textContent = data.saved ? data.saved + ' TON' : '0 TON';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
            document.querySelector('.progress-fill').style.width = (data.conversion || 0) + '%';
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –±–æ—Ç–∞
        tg.onEvent('message', function(event) {
            try {
                const data = JSON.parse(event.text);
                
                if (data.action === 'analysis_progress') {
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
                    document.querySelector('.progress-fill').style.width = data.progress + '%';
                    document.getElementById('progress-percent').textContent = data.progress;
                    document.getElementById('progress-found').textContent = data.found;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç
                    document.querySelector('.loading-text').textContent = 
                        `–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –≥—Ä—É–ø–ø—É... ${data.progress}%`;
                }
                else if (data.action === 'analysis_results') {
                    // –°–∫—Ä—ã–≤–∞–µ–º –æ–≤–µ—Ä–ª–µ–π –∑–∞–≥—Ä—É–∑–∫–∏
                    document.querySelector('.loading-overlay').style.display = 'none';
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                    document.querySelector('.analysis-results').style.display = 'block';
                    document.getElementById('total-potential').textContent = data.stats.total_found;
                    document.getElementById('premium-percent').textContent = 
                        Math.round((data.stats.premium_count / data.stats.total_found) * 100) + '%';
                    document.getElementById('avg-gifts').textContent = 
                        Math.round(data.stats.avg_gifts * 10) / 10;
                }
                else if (data.action === 'analysis_error') {
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
                    document.querySelector('.loading-overlay').style.display = 'none';
                    tg.showAlert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ: ' + data.error);
                }
            } catch (e) {
                console.error('Error processing message:', e);
            }
        });
    </script>
</body>
</html> 
