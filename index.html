<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Bot Manager</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--tg-theme-bg-color, #fff);
            color: var(--tg-theme-text-color, #000);
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        .section {
            background-color: var(--tg-theme-secondary-bg-color, #f5f5f5);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .button {
            background-color: var(--tg-theme-button-color, #2481cc);
            color: var(--tg-theme-button-text-color, #fff);
            border: none;
            padding: 15px 20px;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            margin: 10px 0;
            font-size: 16px;
        }
        .input-field {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: 1px solid var(--tg-theme-hint-color, #999);
            border-radius: 8px;
            font-size: 16px;
            box-sizing: border-box;
        }
        .group-item {
            padding: 15px;
            margin: 10px 0;
            background-color: var(--tg-theme-bg-color, #fff);
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .tab-buttons {
            display: flex;
            margin-bottom: 20px;
        }
        .tab-button {
            flex: 1;
            padding: 10px;
            border: none;
            background: none;
            color: var(--tg-theme-hint-color, #999);
            cursor: pointer;
        }
        .tab-button.active {
            color: var(--tg-theme-button-color, #2481cc);
            border-bottom: 2px solid var(--tg-theme-button-color, #2481cc);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="tab-buttons">
            <button class="tab-button active" onclick="showTab('groups')">Группы</button>
            <button class="tab-button" onclick="showTab('scanner')">Сканер</button>
            <button class="tab-button" onclick="showTab('checker')">Проверка</button>
        </div>

        <!-- Секция управления группами -->
        <div id="groups-tab" class="section">
            <h3>Управление группами</h3>
            <input type="text" class="input-field" id="group-link" placeholder="Ссылка на группу">
            <button class="button" onclick="addGroup()">Добавить группу</button>
            <div id="groups-list">
                <!-- Список групп будет добавляться здесь -->
            </div>
        </div>

        <!-- Секция сканера -->
        <div id="scanner-tab" class="section" style="display: none;">
            <h3>Сканер пользователей</h3>
            <select class="input-field" id="scan-group">
                <!-- Список групп для сканирования -->
            </select>
            <input type="number" class="input-field" id="message-limit" placeholder="Количество сообщений">
            <button class="button" onclick="startScanning()">Начать сканирование</button>
            <div id="scan-results">
                <!-- Результаты сканирования -->
            </div>
        </div>

        <!-- Секция проверки подписок -->
        <div id="checker-tab" class="section" style="display: none;">
            <h3>Проверка подписок</h3>
            <input type="text" class="input-field" id="user-id" placeholder="ID пользователя">
            <select class="input-field" id="check-group">
                <!-- Список групп для проверки -->
            </select>
            <button class="button" onclick="checkSubscription()">Проверить подписку</button>
            <div id="check-result">
                <!-- Результат проверки -->
            </div>
        </div>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();

        // Показ/скрытие вкладок
        function showTab(tabName) {
            document.querySelectorAll('.section').forEach(tab => tab.style.display = 'none');
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`${tabName}-tab`).style.display = 'block';
            event.target.classList.add('active');
        }

        // Добавление группы
        function addGroup() {
            const groupLink = document.getElementById('group-link').value;
            if (!groupLink) {
                tg.showAlert('Введите ссылку на группу');
                return;
            }

            tg.sendData(JSON.stringify({
                action: 'add_group',
                group_link: groupLink
            }));
        }

        // Начало сканирования
        function startScanning() {
            const groupId = document.getElementById('scan-group').value;
            const messageLimit = document.getElementById('message-limit').value;

            if (!groupId || !messageLimit) {
                tg.showAlert('Заполните все поля');
                return;
            }

            tg.sendData(JSON.stringify({
                action: 'start_scan',
                group_id: groupId,
                message_limit: messageLimit
            }));
        }

        // Проверка подписки
        function checkSubscription() {
            const userId = document.getElementById('user-id').value;
            const groupId = document.getElementById('check-group').value;

            if (!userId || !groupId) {
                tg.showAlert('Заполните все поля');
                return;
            }

            tg.sendData(JSON.stringify({
                action: 'check_subscription',
                user_id: userId,
                group_id: groupId
            }));
        }

        // Обновление списка групп
        function updateGroupsList(groups) {
            const groupsList = document.getElementById('groups-list');
            groupsList.innerHTML = '';
            
            groups.forEach(group => {
                const groupElement = document.createElement('div');
                groupElement.className = 'group-item';
                groupElement.innerHTML = `
                    <div>
                        <strong>${group.title}</strong><br>
                        <small>${group.link}</small>
                    </div>
                    <button onclick="removeGroup('${group.id}')" class="button">Удалить</button>
                `;
                groupsList.appendChild(groupElement);
            });

            // Обновляем списки выбора групп
            updateGroupSelects(groups);
        }

        // Обновление списков выбора групп
        function updateGroupSelects(groups) {
            const scanGroup = document.getElementById('scan-group');
            const checkGroup = document.getElementById('check-group');
            
            const options = groups.map(group => 
                `<option value="${group.id}">${group.title}</option>`
            ).join('');

            scanGroup.innerHTML = options;
            checkGroup.innerHTML = options;
        }

        // Получаем данные при загрузке
        document.addEventListener('DOMContentLoaded', function() {
            tg.sendData(JSON.stringify({
                action: 'get_groups'
            }));
        });
    </script>
</body>
</html> 
